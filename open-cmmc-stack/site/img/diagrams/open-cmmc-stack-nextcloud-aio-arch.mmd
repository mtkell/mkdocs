flowchart LR
  %% External User Zone
  User[/"User (Browser, Client)"/]

  %% Reverse Proxy
  NGINX["NGINX Proxy Manager<br/>(TLS Termination)"]

  %% Internal Secure Services
  Keycloak["Keycloak<br/>(SSO, MFA, RBAC)"]
  NC["Nextcloud AIO<br/>(Files, AV, OnlyOffice, Talk)"]
  Mailcow["Mailcow<br/>(SMTP, IMAP, Webmail)"]
  DB["Internal Services<br/>(PostgreSQL, Redis)"]

  %% Optional Federation
  Entra(["Microsoft Entra ID<br/>(Optional SAML IDP)"])

  %% Edges
  User --> NGINX
  NGINX --> Keycloak
  NGINX --> NC
  NGINX --> Mailcow
  Keycloak --> Entra
  NC --> DB
  Mailcow --> DB